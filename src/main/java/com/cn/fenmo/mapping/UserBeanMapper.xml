<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.cn.fenmo.dao.UserBeanMapper" >
  <resultMap id="BaseResultMap" type="com.cn.fenmo.pojo.UserBean" >
    <id column="mainId" property="mainid" jdbcType="BIGINT" />
    <result column="fmNo" property="fmNo" jdbcType="VARCHAR" />
    <result column="userName" property="username" jdbcType="VARCHAR" />
    <result column="passWord" property="password" jdbcType="VARCHAR" />
    <result column="imgUrls" property="imgUrls" jdbcType="VARCHAR" />
    <result column="specificSign" property="specificsign" jdbcType="VARCHAR" />
    <result column="age" property="age" jdbcType="INTEGER" />
    <result column="sex" property="sex" jdbcType="INTEGER" />
    <result column="phone" property="phone" jdbcType="DECIMAL" />
    <result column="constellation" property="constellation" jdbcType="VARCHAR" />
    <result column="hxId" property="hxid" jdbcType="VARCHAR" />
    <result column="circle" property="circle" jdbcType="INTEGER" />
    <result column="idol" property="idol" jdbcType="VARCHAR" />
    <result column="nickname" property="nickname" jdbcType="VARCHAR" />
    <result column="token" property="token" jdbcType="VARCHAR" />
    <result column="headImgPath" property="headImgPath" jdbcType="VARCHAR" />
    <result column="nationality" property="nationality" jdbcType="VARCHAR" />
    <result column="occupation" property="occupation" jdbcType="VARCHAR" />
    <result column="birthday" property="birthday" jdbcType="DATE" />
  </resultMap>
   <sql id="Base_Column_List" >
     mainId, userName, passWord, imgUrls, specificSign, age, sex, phone, constellation,hxId,
     circle, idol,nickname,token,nationality,occupation,birthday,headImgPath
   </sql>
   <insert id="insert" parameterType="com.cn.fenmo.pojo.UserBean" >
      insert into fm_user (mainId,fmNo, userName, passWord,specificSign, age, sex, phone, constellation, 
      circle, idol,nickname,token,nationality,occupation,birthday)
      values (#{mainid,jdbcType=BIGINT},#{fmNo,jdbcType=VARCHAR}, #{username,jdbcType=VARCHAR}, #{password,jdbcType=VARCHAR}, 
      #{specificsign,jdbcType=VARCHAR}, #{age,jdbcType=INTEGER}, 
      #{sex,jdbcType=INTEGER}, #{phone,jdbcType=DECIMAL}, #{constellation,jdbcType=VARCHAR}, 
      #{circle,jdbcType=INTEGER}, #{idol,jdbcType=VARCHAR},#{nickname,jdbcType=VARCHAR},
      #{token,jdbcType=VARCHAR},#{nationality,jdbcType=VARCHAR},#{occupation,jdbcType=VARCHAR},#{birthday,jdbcType=DATE})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.cn.fenmo.pojo.UserBean" >
    update fm_user
    set userName = #{username,jdbcType=VARCHAR},
      passWord = #{password,jdbcType=VARCHAR},
      imgUrls = #{imgUrls,jdbcType=VARCHAR},
      specificSign = #{specificsign,jdbcType=VARCHAR},
      age = #{age,jdbcType=INTEGER},
      sex = #{sex,jdbcType=INTEGER},
      phone = #{phone,jdbcType=DECIMAL},
      constellation = #{constellation,jdbcType=VARCHAR},
      hxId = #{hxid,jdbcType=VARCHAR},
      circle = #{circle,jdbcType=INTEGER},
      idol = #{idol,jdbcType=VARCHAR},
      nickname = #{nickname,jdbcType=VARCHAR},
      token = #{token,jdbcType=VARCHAR},
      nationality = #{nationality,jdbcType=VARCHAR},
      occupation = #{occupation,jdbcType=VARCHAR},
      birthday = #{birthday,jdbcType=DATE},
      headImgPath = #{headImgPath,jdbcType=VARCHAR}
      where mainId = #{mainid,jdbcType=BIGINT}
  </update>
  <select id="selectByPrimaryKey" resultMap="BaseResultMap" parameterType="java.lang.Long" >
    select 
    <include refid="Base_Column_List" />
    from fm_user
    where mainId = #{mainid,jdbcType=BIGINT}
  </select>
  
  <select id="selectMyFriendCount" resultType="Integer" parameterType="java.util.Map" >
    select count(*)
    from fm_user
    where phone in (select friendPhone  from fm_friend  where userPhone =#{userPhone,jdbcType=BIGINT} and state = #{state,jdbcType=INTEGER})
  </select>
  
  <select id="selectMyFriend" resultMap="BaseResultMap" parameterType="java.util.Map" >
    select 
    <include refid="Base_Column_List" />
    from fm_user
    where phone in (select friendPhone  from fm_friend where userPhone =#{userPhone,jdbcType=BIGINT} and state = #{state,jdbcType=INTEGER})
    LIMIT #{start,jdbcType=VARCHAR},#{limit,jdbcType=VARCHAR}
  </select>
  
   <select id="selectMembers" resultMap="BaseResultMap" parameterType="java.util.Map" >
	    select <include refid="Base_Column_List" />
	    from fm_user
	    where userName in (select userName  from fm_room_users where groupId =#{groupId,jdbcType=VARCHAR})
  </select>
  
   <select id="selectMyFriendCountBy" resultType="Integer" parameterType="java.util.Map" >
     select count(*)
     from fm_user
     where phone in (select friendPhone  from fm_friend  where userPhone =#{userPhone,jdbcType=BIGINT} and state = #{state,jdbcType=INTEGER})
     and (nickName like '%${searchKey}%'  or userName like '%${searchKey}%' or fmNo like '%${searchKey}%')
   </select>
   
   <select id="selectMyFriendBy" resultMap="BaseResultMap" parameterType="java.util.Map" >
	    select 
	    <include refid="Base_Column_List" />
	    from fm_user
	    where phone in (select friendPhone  from fm_friend where userPhone =#{userPhone,jdbcType=BIGINT} and state = #{state,jdbcType=INTEGER})
        and (nickName like '%${searchKey}%'  or userName like '%${searchKey}%' or fmNo like '%${searchKey}%')
	    LIMIT #{start,jdbcType=VARCHAR},#{limit,jdbcType=VARCHAR}
  </select>
  
  <select id="selectByPhone" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from fm_user
    where phone = #{phone,jdbcType=VARCHAR}
  </select>
  
   <select id="selectByToken" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from fm_user
    where token = #{token,jdbcType=VARCHAR}
  </select>
  
  <select id="selectByFmNo" resultMap="BaseResultMap" parameterType="java.lang.String" >
    select 
    <include refid="Base_Column_List" />
    from fm_user
    where fmNo = #{fmNo,jdbcType=VARCHAR}
  </select>
  
  <select id="selectCount" resultType="Integer" parameterType="java.util.Map">
      select count(*)
      from fm_user
      where  1=1
      <if test="phone!= null" >
         and phone like '%${phone}%'     
      </if>
      <if test="nickName!= null" >
         and nickName like '%${nickName}%'     
      </if>
      <if test="fmNum!= null" >
         and fmNum like '%${fmNum}%'  
      </if>
      <if test="age==2">
         and age <![CDATA[<=]]>20 
      </if>
      <if test="age==3">
         and age BETWEEN 20 AND 30
      </if>
      <if test="age==4">
         and age <![CDATA[>=]]>30 
      </if>
      <if test="sex!=null" >
         and sex = #{sex,jdbcType=VARCHAR}
      </if> 
  </select>
  
   <select id="selectPageBy" resultMap="BaseResultMap" parameterType="java.util.Map">
	    select 
	    <include refid="Base_Column_List" />
	    from fm_user
	    where 1=1
	    <if test="phone!= null" >
           and phone like '%${phone}%'     
       </if>
       <if test="nickName!= null" >
           and nickName like '%${nickName}%'     
       </if>
	    <if test="fmNum!= null" >
           and fmNum like '%${fmNum}%'  
        </if>
	    <if test="age==2">
           and age <![CDATA[<=]]>20 
        </if>
        <if test="age==3">
           and age BETWEEN 20 AND 30
        </if>
        <if test="age==4">
           and age <![CDATA[>=]]>30 
        </if>
        <if test="sex!=null" >
           and sex = #{sex,jdbcType=VARCHAR}
        </if>  
	    LIMIT #{start,jdbcType=VARCHAR},#{limit,jdbcType=VARCHAR}
   </select>
   
   <delete id="deleteByPrimaryKey" parameterType="java.lang.Long" >
     delete from fm_user
     where mainId = #{mainid,jdbcType=BIGINT}
   </delete>

  
  <update id="updateByPrimaryKeySelective" parameterType="com.cn.fenmo.pojo.UserBean" >
    update fm_user
    <set>
      <if test="headImgPath != null" >
        headImgPath = #{headImgPath,jdbcType=VARCHAR},
      </if>
      <if test="username != null" >
        userName = #{username,jdbcType=VARCHAR},
      </if>
      <if test="password != null" >
        passWord = #{password,jdbcType=VARCHAR},
      </if>
      <if test="imgUrls != null" >
        imgUrls = #{imgUrls,jdbcType=VARCHAR},
      </if>
      <if test="specificsign != null" >
        specificSign = #{specificsign,jdbcType=VARCHAR},
      </if>
      <if test="age != null" >
        age = #{age,jdbcType=INTEGER},
      </if>
      <if test="sex != null" >
        sex = #{sex,jdbcType=INTEGER},
      </if>
      <if test="phone != null" >
        phone = #{phone,jdbcType=DECIMAL},
      </if>
      <if test="constellation != null" >
        constellation = #{constellation,jdbcType=VARCHAR},
      </if>
      <if test="hxid != null" >
        hxId = #{hxid,jdbcType=VARCHAR},
      </if>
      <if test="circle != null" >
        circle = #{circle,jdbcType=INTEGER},
      </if>
      <if test="idol != null" >
        idol = #{idol,jdbcType=VARCHAR},
      </if>
      <if test="nickname != null" >
        nickname = #{nickname,jdbcType=VARCHAR},
      </if>
      <if test="token != null" >
        token = #{token,jdbcType=VARCHAR},
      </if>
       <if test="nationality != null" >
        nationality = #{nationality,jdbcType=VARCHAR},
      </if>
       <if test="occupation != null" >
        occupation = #{occupation,jdbcType=VARCHAR},
       </if>
       <if test="birthday != null" >
        birthday = #{birthday,jdbcType=DATE}
       </if>
    </set>
    where mainId = #{mainid,jdbcType=BIGINT}
  </update>
  <select id="selectUserList" resultType="com.cn.fenmo.pojo.UserBean" parameterType="java.util.List">
        select *
        from fm_user e
        where e.userName in
        <foreach collection="list" item="userId" index="index"
            open="(" close=")" separator=",">
            #{userId}
        </foreach>
   </select>
   <select id="selectUserByUserPhoneList" resultType="com.cn.fenmo.pojo.UserBean" parameterType="java.util.List">
        select e.mainId,e.nickName,e.userName
        from fm_user e
        where e.userName in
        <foreach collection="list" item="userPhone" index="index"
            open="(" close=")" separator=",">
            #{userPhone}
        </foreach>
    </select>
</mapper>